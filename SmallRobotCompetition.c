#pragma config(I2C_Usage, I2C1, i2cSensors)
#pragma config(Sensor, in1,    PowerExpander,  sensorAnalog)
#pragma config(Sensor, in6,    RightLine,      sensorLineFollower)
#pragma config(Sensor, in7,    MiddleLine,     sensorLineFollower)
#pragma config(Sensor, in8,    LeftLine,       sensorLineFollower)
#pragma config(Sensor, dgtl4,  PusherEncoderRight,   sensorQuadEncoder)
#pragma config(Sensor, dgtl6,  PusherEncoderLeft,    sensorQuadEncoder)
#pragma config(Sensor, dgtl12, PusherHomeLimit,          sensorTouch)
#pragma config(Sensor, I2C_1,  ,               sensorQuadEncoderOnI2CPort,    , AutoAssign )
#pragma config(Sensor, I2C_2,  ,               sensorQuadEncoderOnI2CPort,    , AutoAssign )
#pragma config(Motor,  port1,           RightPush,     tmotorVex393_HBridge, openLoop)
#pragma config(Motor,  port2,           RightFront,    tmotorVex393_MC29, openLoop, reversed, driveRight)
#pragma config(Motor,  port3,           RightMiddle,   tmotorVex393_MC29, openLoop, reversed, driveRight, encoderPort, I2C_1)
#pragma config(Motor,  port4,           RightRear,     tmotorVex393_MC29, openLoop, reversed, driveRight)
#pragma config(Motor,  port5,           RightIntake,   tmotorVex393_MC29, openLoop)
#pragma config(Motor,  port6,           LeftFront,     tmotorVex393_MC29, openLoop, driveLeft)
#pragma config(Motor,  port7,           LeftMiddle,    tmotorVex393_MC29, openLoop, driveLeft, encoderPort, I2C_2)
#pragma config(Motor,  port8,           LeftRear,      tmotorVex393_MC29, openLoop, driveLeft)
#pragma config(Motor,  port9,           LeftIntake,    tmotorVex393_MC29, openLoop, reversed)
#pragma config(Motor,  port10,          LeftPush,      tmotorVex393_HBridge, openLoop, reversed)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

/*

 Note:
    the channels 1-5 are on one breaker channel, 6-10 are on another

 Drive motor read in:
    i²C1 -> right drive
    i²C2 -> left drive

 Traverse motors (power expander)
    port 1  -> right
    port 10 -> left

 Feeder motors (power expander)
    port 2  -> right
    port 9  -> left

 Drive motors
    port 3 -> right 1
    port 4 -> right 2
    port 5 -> right 3
    port 6 -> left 1
    port 7 -> left 2
    port 8 -> left 3

 Analog battery power from power expander
    analog input port 1

*/




#pragma platform(VEX)

// Competition Control and Duration Settings
#pragma competitionControl(Competition)
#pragma autonomousDuration(45)
#pragma userControlDuration(75)

#include "Vex_Competition_Includes.c"   //Main competition background code...do not modify!

#include "smallbot_control.h"
#include "jobs.h"
#include "emptyballs.h"
#include "testjob1.h"


/////////////////////////////////////////////////////////////////////////////////////////
//
//                          Pre-Autonomous Functions
//
// You may want to perform some actions before the competition starts. Do them in the
// following function.
//
/////////////////////////////////////////////////////////////////////////////////////////

void pre_auton()
{
  // Set bStopTasksBetweenModes to false if you want to keep user created tasks running between
  // Autonomous and Tele-Op modes. You will need to manage all user created tasks if set to false.
  bStopTasksBetweenModes = true;

	// All activities that occur before the competition starts
	// Example: clearing encoders, setting servo positions, ...
}

/////////////////////////////////////////////////////////////////////////////////////////
//
//                                 Autonomous Task
//
// This task is used to control your robot during the autonomous phase of a VEX Competition.
// You must modify the code to add your own robot specific commands here.
//
/////////////////////////////////////////////////////////////////////////////////////////

task autonomous() {
}

/////////////////////////////////////////////////////////////////////////////////////////
//
//                                 User Control Task
//
// This task is used to control your robot during the user control phase of a VEX Competition.
// You must modify the code to add your own robot specific commands here.
//
/////////////////////////////////////////////////////////////////////////////////////////

task usercontrol() {

        /* This is the process of creating a job */
	testjob1_data duration = { .duration = 2000 };
	Command testjob1 = {
            .name = "testjob1",
            .starttime = nSysTime, // NOTE: THIS DOES NOT WORK!!!! FIXME
            .start = testjob1_start,
            .update = testjob1_update,
            .stop = testjob1_stop,
            .data = &duration,
            .freecmd = 0
        };
	jobhandler_startcommand(&testjob1);

        /* This is the process of creating a job */
	testjob1_data duration = { .duration = 2000 };
        emptyballs_data ebd;
	Command emptyballs = {
            .name = "emptyballs on trigger 7r",
            .starttime = nSysTime, // NOTE: see above. FIXME
            .start  = emptyballs_start,
            .update = emptyballs_update,
            .stop   = emptyballs_stop,
            .data   = &ebd,
            .freecmd = 0
        };


	/* You shouldn't have to change anything below here */

	while (true) {
		jobhandler_tick();
		if(vexRT[Btn7R]) // This should be done in the userinput command (NYI/FIXME)
			jobhandler_startcommand(&emptyballs);
	}
}


// silly robot c; not being able to do linking...
#include "smallbot_control.c"
#include "jobs.c"
#include "emptyballs.c"
#include "testjob1.c"
